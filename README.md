# DaTaK - IoT Edge Gateway & Data Aggregator

<p align="center">
  <img src="frontend/public/logo.png" alt="DaTaK Logo" width="120" />
</p>

<p align="center">
  Industrial IoT gateway for multi-protocol data acquisition with local processing, resilient storage, and Digital Twin forwarding.
  <br />
  <strong>Developed by <a href="https://robotika.cloud">Robotika</a> - IoT Solutions</strong>
</p>

---

## Features

- **Multi-Protocol Support**: Modbus TCP/RTU, CANbus (with DBC parsing), MQTT
- **Hot-Reload**: Add/remove sensors without service restart
- **Offline Resilience**: Store & Forward queue for network failures
- **Statistical Reports**: Automated CSV generation with Min/Max/Avg/StdDev
- **Secure Formula Engine**: Sandboxed Python expressions for data transformation
- **Real-time Dashboard**: Vue.js UI with WebSocket updates
- **Digital Twin Integration**: MQTT-based forwarding to cloud platforms
- **Automation Rules**: Local control loops with condition-based triggers

---

## Requirements

### System Requirements
- **OS**: Linux (Ubuntu 20.04+, Debian 11+) or Windows with WSL2
- **Docker**: v24.0+ with Docker Compose v2.20+
- **RAM**: Minimum 2GB, recommended 4GB+
- **Storage**: Minimum 10GB free space

### Software Dependencies
- Docker & Docker Compose
- Git
- (Optional) Python 3.12+ for local development

---

## Quick Start (Docker - Recommended)

The fastest way to get DaTaK running is with Docker:

```bash
# 1. Clone repository
git clone https://github.com/k8-benetis/datak.git
cd datak

# 2. Copy configuration template
cp configs/gateway.example.yaml configs/gateway.yaml

# 3. Start all services
cd docker
docker compose up -d --build

# 4. Access the application
# Frontend: http://localhost:5173
# API Docs: http://localhost:8000/docs
# Default login: admin / admin
```

---

## Development Setup

For local development without Docker:

```bash
# Backend
cd backend
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -e ".[dev]"
alembic upgrade head
python -m app.main

# Frontend (separate terminal)
cd frontend
npm install
npm run dev
```

> **Note**: You still need InfluxDB and Mosquitto running. Use `docker compose up influxdb mosquitto -d` from the `docker/` folder.

---

## Architecture

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Modbus Devices │     │  ESP32 (MQTT)   │     │  CANbus Network │
└────────┬────────┘     └────────┬────────┘     └────────┬────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌────────────▼────────────┐
                    │    DaTaK Gateway        │
                    │  ┌─────────────────┐    │
                    │  │  Async Drivers  │    │
                    │  └────────┬────────┘    │
                    │  ┌────────▼────────┐    │
                    │  │  Formula Engine │    │
                    │  └────────┬────────┘    │
                    │  ┌────────▼────────┐    │
                    │  │ Store & Forward │    │
                    │  └────────┬────────┘    │
                    └───────────┼─────────────┘
                                │
         ┌──────────────────────┼──────────────────────┐
         │                      │                      │
┌────────▼────────┐  ┌──────────▼──────────┐  ┌───────▼───────┐
│   InfluxDB      │  │   Digital Twin      │  │   CSV Reports │
│   (Time-series) │  │   (MQTT Cloud)      │  │   (Local)     │
└─────────────────┘  └─────────────────────┘  └───────────────┘
```

---

## Project Structure

```
datak/
├── backend/          # FastAPI + async drivers
├── frontend/         # Vue.js 3 dashboard
├── docker/           # Docker compose files
├── configs/          # Gateway configuration
├── images/           # Logo assets
└── scripts/          # Deployment utilities
```

---

## Configuration

Copy `configs/gateway.example.yaml` to `configs/gateway.yaml` and adjust:

```yaml
gateway:
  name: "My-Gateway"
  
influxdb:
  url: "http://influxdb:8086"
  token: "datak-dev-token"
  org: "datak"
  bucket: "sensors"
  retention_days: 30

digital_twin:
  enabled: true
  host: "mqtt.your-twin.com"
  port: 8883
  topic: "/your/topic/attrs"
```

---

## Contact & Support

**Robotika** - IoT Solutions  
- Website: [https://robotika.cloud](https://robotika.cloud)  
- Email: [kate@robotika.cloud](mailto:kate@robotika.cloud)

---

## License

AGPL-3.0 - See [LICENSE](LICENSE) for details.
